#summary How to build and flash a Mobile Commerce Extension (Mc-EX) enabled kernel

== How to build and flash a Mobile Commerce Extension (Mc-EX) enabled kernel ==

The following description has been tested with Android 1.5 (cupcake) and Android 1.6 (donut). When [http://source.android.com/download downloading] and [http://source.android.com/documentation/building-for-dream building] the Android sources you get an Android system with a prebuilt kernel. To get an Android system with your own kernel you have to do some additional steps as described next.

=== Get the kernel sources ===
Add a "local_manifest.xml" file to your "`<mydroid>/.repo`" directory. The "local_manifest.xml" file should look like as follows:

{{{
<?xml version="1.0" encoding="UTF-8" ?> 
<manifest>
  <project path="kernel" name="kernel/msm" revision="refs/heads/android-msm-2.6.27" /> 
</manifest>
}}}

After running
{{{
repo sync
}}}
you should find the kernel sources in your "`<mydroid>/kernel`" directory.

=== Get the kernel configuration file ===
Copy the configuration of the prebuilt kernel of your device as follows:

{{{
adb pull /proc/config.gz <mydroid>/kernel/config.gz
gunzip < <mydroid>/kernel/config.gz > <mydroid>/kernel/.config
}}}

=== Build your own kernel ===
Enter your "`<mydroid>/kernel`" directory and build the kernel as follows:
{{{
make ARCH=arm CROSS_COMPILE=arm-eabi-
}}}

=== Integrate your own kernel to the Android system ===
Enter your "`<mydroid>`" directory and run
{{{
export TARGET_PREBUILT_KERNEL=<mydroid>/kernel/arch/arm/boot/zImage
make
}}}

=== Download and apply the Mc-EX patches ===
Apply the Mc-EX patches and rebuilt first the kernel and then the Android system as described above. A short description on how to apply the patches can be found inside each archive.

http://seek-for-android.googlecode.com/files/20090928_mcexdevnode.tar.bz2<br>
Temporarily unavailable: seek-for-android.googlecode.com/files/20091023_mcexdrv.tar.bz2

=== Flash your own kernel ===
*Backup the Android system of your device before you do this last step.*
{{{
fastboot flash boot <mydroid>/out/target/product/dream-open/boot.img
}}}