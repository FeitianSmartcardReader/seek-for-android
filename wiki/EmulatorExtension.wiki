#summary How to enable the emulator talk with a SIM card connected through PC/SC

= Introduction =

The Android emulator is only supporting a primitive 'fake' SIM card it cannot be used to extend the Sim Toolkit framework. On real devices, the RIL library is very restrictive in terms of STK support.<br/>
This patch enables the Android emulator to forward any APDU traffic (AT+CRSM commands) to a real SIM card that is connected through a PC/SC card reader and accessible with pcsc-lite.
<br/><br/>


== Applying the patch to the emulator sources ==

  * Download the [http://seek-for-android.googlecode.com/files/emulator_extensions.tar.gz patch archive]
  * Unpack the patch archive: <code>tar xfvz emulator_extensions.tar.gz</code>
  * Apply the patches in the root folder of the Android source tree: <code>patch -p1 < hardware_ril.patch; patch -p1 < external_qemu.patch</code>
  * Download and build pcsc-lite:
{{{
tar xfvj pcsc-lite-<version>.tar.bz2
cd <path/to/pcsc-lite>
./configure; make
}}}
  * Rebuild the emulator with PC/SC support: 
{{{
touch external/qemu/telephony/sim_card.c
touch external/qemu/android/cmdline-option.c
PCSCLITE_INCPATH=<path/to/pcsc-lite>/src/PCSC PCSCLITE_LIBPATH=<path/to/pcsc-lite>/src/.libs make
}}}
  * Create an AVD and launch the emulator:
{{{
android create avd -n Android_2.2 -t 12
ANDROID_SDK_ROOT=<path/to/android-sdk-linux> ./out/host/linux-x86/bin/emulator -avd Android_2.2 -system out/target/product/generic/system.img -pcsc <reader>
}}}
  * In the emulator output a card reader will get listed, e.g. _sim_card.c: using card reader Cherry XX44 00 00_
  * If a SIM Toolkit application is located on the SIM card inserted to the card reader, the Android SIM Toolkit (Stk) application can be used to test/debug the card applet.
http://seek-for-android.googlecode.com/svn/wiki/img/EmulatorExtensionScreenshot.png