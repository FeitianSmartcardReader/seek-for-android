#summary Installable MSC_SmartcardService for Android phones that are not flashed

= Introduction =

Flashing the system is not supported on every device, thus using the !SmartCard API is limited to development phone only.<br/>
However, access to Secure Elements does not always require flashing the system image. Also, application developers can use the !SmartcardService as a quick way to develop their applications as well as end users who just want to use an application with smart card support.<br/>
_MSC !SmartcardService_ enables (any) Android phone with SD card slot to use !SmartCard API without flashing the system or rooting the phone.<br/>
The _APK_ inside the archive can be installed on the device like on any other Android application.<br/>
*Note*<br>
 * The _MSC !SmartcardService_ will only support the [https://www.cardsolutions-shop.com/shop/gi-de/ G&D Mobile Security Card]
 * The source code of _MSC !SmartcardService_ is equal to the !SmartCard API from SVN with the exception of `libmsc.so` which will not be provided Open Source.  
<br/>

= Details = 
To access the SE on the MSC there are two interfaces available. The Advanced Security SD (ASSD) interface is specified by the SD Association and allows the host to access the SE over a set of standardized SD commands. If the host does not support the additional ASSD commands or it is not possible to include the ASSD (kernel) driver, there is a non-standard possibility to access the SE over special reads and writes to the file system. This requires that the card is accessible through the hosts file system or on a block-level without caching in between (O_DIRECT required). The standardized ASSD interface should be the preferred solution if the host is capable to provide ASSD functionality. 

The MSC drivers uses the host operating file system calls to transfer the APDUs between card and host. It appears to the host as if standard read and write commands were performed on a specific file on the SD card.

It is required that no caching mechanism is in between that block direct file access, e.g. when a crypto layer is in between.

Drivers for the MSC are available for many platforms and provided by G&D Secure Flash Solutions (GDSFS) directly.<br/>

<table>
<tr>
<td valign="top" width=55%>
= Installation =
To test the _MSC !SmartcardService_
 * delete older version of MSC_SmartcardService.apk and OpenMobileAPISample.apk on the phone

 * download the [http://seek-for-android.googlecode.com/files/MSC%20Smartcard%20Service%203.0.tar.gz MSC SmartcardService 3.0.tar.gz] and extract the content

 * ensure that _USB debugging_ is enabled on the phone<br/>(_Settings_ - _Applications_ - _Development_ - _USB debugging_)

 * execute `adb install MSC_SmartcardService.apk`

 * execute `adb install OpenMobileAPISample.apk`

 * ensure a [https://www.cardsolutions-shop.com/shop/gi-de/ Mobile Security Card] is inserted in the phone

 * on the phone, run the OpenMobileAPISample application and see the log output

 * a GlobalPlatform compliant Access Control applet is optional for the Mobile Security card. If it is installed, the MSC Smartcard Service will grant access to the Mobile Security Card based on the rules that the applet defines.
</td>
<td width=5%>
</td>
<td width=40%>
<img src=http://seek-for-android.googlecode.com/svn/wiki/img/MscSmartcardService_screenshot.png width=250/>
</td>
</tr>
</table>

= Development =
The _MSC !SmartcardService_ provides the *same* interface as the !SmartCard API so application developers can write and test their applications with the installable version and have no migration issues later on. Note that the package names are different for the _MSC !SmartcardService_ (com.mobilesecuritycard.`*`) and the !SmartCard API (org.simalliance.`*`).<br/>
Use the provided com.mobilesecuritycard.openmobileapi.jar and the sample project to develop Android applications.

==== Access Control ====
As the [AccessControlIntroduction GlobalPlatform Secure Element Access Control] is also included in the _MSC !SmartcardService_, a corresponding Access Control application can optionally be installed in the MSC and personalized with the proper rules.<br/>
For development purposes, the [AllowAll dummy-ARA applet] can be used that grants access to the MSC for any application.
In case no Access Control application can be selected on the MSC, Access control will be disabled.
<br/>

==== Write permission to the MSC ====
Since AOSP 3.x application will not have write access to MicroSD cards out of the box which will also hinder the _MSC !SmartcardService_ to work. Most commercial device have implemented a _work around_ for this issue but it is up to the OEM to implement such.<br/>
_Background_: the new `WRITE_MEDIA_STORAGE` permission for the `MEDIA_RW` gid is protected with the `signatureOrSystem` level hindering all user application to retrieve such. See `frameworks/base/core/res/AndroidManifest.xml, frameworks/base/data/etc/platform.xml` and `system/vold/Volume.cpp` for more details.